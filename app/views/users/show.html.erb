<% provide(:title, "Progress") %>
<div class="profile">
<div class="row">
<div class="col-md-12">
	<div class="well well-small clearfix">
		<div class="row-fluid">
			<div class="col-md-4">
				<h2 style="font-weight:bold"><%= @user.username %></h2>
				<ul class="list-unstyled">
					<li>
						<% if !@user.country.empty? %>
							<%= flag_icon(:"#{@user.country}", class: 'strong') %>
						<% end %>
					</li>
				</ul>
			</div>
			<div class="col-md-6">
				<ul class="inline stats">
					<li>
						<span><%= @user.score %> </span>
						Score
					</li>
					<li>
						<span><%= @user.solved %> </span>
						Problems Solved
					</li>	
					<li>
						<span><%= @kudos %></span>
						Kudos
					</li>
				</ul>
			</div>
			<div class="col-md-2">
				<% if current_user != @user && !current_user.friends.include?(@user) %>
					<%= button_to "Add Friend", friend_path(:id => @user),
																		:method => :post,
																		:class => "btn btn-default",
																		:style => "margin-left:50%; width:60%;" %>
				<% elsif current_user != @user && current_user.friends.include?(@user) %>
					<%= button_to "Message", message_path(:recipient_id => @user.id),
																		:method => :post,
																		:class => "btn btn-default",
																		:style => "margin-left:50%; width:60%;margin-top:5%;" %>
				<% end %>

			</div>
		</div>
	</div>
	</div>
	</div>
</div>

<% if @user.solved > 0 %>
	<% problems = problems_to_display(@user) %>
	<div class="form_box">
		<div id="problem_history">
			<h5>Last <%= pluralize(problems.length, 'problem') %> Solved</h3>
			<table class="table table-bordered">
					<% count = 1 %>
					<% problems.each do |problem_solved| %>
						<tr>
							<td><%= count %></td>
							<td>Problem <%=problem_solved.problem_id %></td>
							<td><%= problem_solved.created_at.strftime("%a, %d %b %Y, %I:%M %p") %></td>
						</tr>
						<% count += 1 %>
					<% end %>
				
			</table>
		</div>

	</div>
<% end %>

<div id="progress">
	<h4>Solved <%= @user.solved %> out of <%= Problem.count %> problems</h4>
	<div class="progress">
	<div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="<%=@user.solved / Problem.count.to_f * 100  %>" aria-valuemin="0" aria-valuemax="100" style="width:<%=@user.solved / Problem.count.to_f * 100  %>%"> 
  </div>
	</div>	
</div>

<div id="problems_solved_section">
	<h4>Problems Solved</h4>
	<% problems = Problem.all.order(:id) %>
	<% index = 0 %>
	<% problems.each do |problem| %>
		<% solved = false %>
		<% if (problem.id - 1) % 100 == 0 %>
			<% if (problem.id / 100) >= 1 %>
				</tbody>
				</table>
			<% end %>
			<table class="problems_solved_table">
			<tbody>
		<% end %>
		<% if (problem.id - 1) % 20 == 0 %>
			<% if (problem.id / 20) >= 1 %>
				</tr>
			<% end %>
			<tr>
		<% end %>
		<% if @problems[index] == problem %>
			<td class="problem_solved">
			<% index += 1 %>
			<% solved = true %>
		<% else %>
			<td class="problem_unsolved">
		<% end %>
			<a href=<%= problem_path(problem.id) %> style="color:inherit;text-decoration:none;">
				<div class="problem_info">
					<%= problem.id  %>
					<span class="infobox">
						<%= raw put_info(@user, problem, solved) %>
					</span>
				</div>
			</a>
		</td>
	<% end %>
</div>

